<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="../test/example-stylist-credentials.js"></script>
    <script type="text/javascript">
        $(function () {
            $(document).ready(function () {

                // for this example we use the hard-coded
                // values in stylist_credentials.js
                // in real usage scenarios, wi will
                // prompt for some of these values,
                // or get them from a controlling system

                $('#username').val(stylist_username);
                $('#secret').val(stylist_password);
                $('#oauth_consumer_key').val(oauth_consumer_key);
                $('#grant_type').val(grant_type);
            });
        });
    </script>
    <script type="text/javascript">
        $(function () {
            function submitAuthenticateForm() {
                var formData = $('#authForm').serialize();
                $.ajax(
                    {
                        url: 'https://signon.shortcutssoftware.com/authenticate',
                        type: 'POST',
                        xhrFields: {withCredentials: true},
                        crossDomain: true,
                        data: formData,
                        beforeSend: function (xhr) {
                            // we must supply the signon server with the
                            // encoded username/password pair, set in
                            // the Authorization header
                            var u = $('#username').val();
                            var p = $('#secret').val();
                            var encoded_pair = btoa(u + ':' + p);
                            xhr.setRequestHeader('Authorization', 'Basic ' + encoded_pair);
                        }
                    }).then(function (data, textStatus, jqXHR) {

                        // when the signon server returns ok then we
                        // redirect to the site below.

                        // NB: make sure you redirect to a site to
                        // which this user has access permissions.
                        // if you redirect to a site that the user
                        // does not have access permissions for,
                        // then you will just be redirected back
                        // to the signon screen. this may appear
                        // as if stylist single sign-on is not
                        // working, when it is just a matter
                        // of selecting the correct site.

                        var site_url = 'https://pos.shortcutssoftware.com/site/37176';
                        alert('signon successful - redirecting to ' + site_url);
                        // note: the xhr returned an OAuth cookie,
                        // this is what wll give us access to the
                        // site that we are redirecting to.
                        window.location.replace(site_url);
                    },
                    function (jqXHR, textStatus, errorThrown) {
                        // when the signon server returns
                        // an error then we display it
                        alert(JSON.stringify(jqXHR));
                    }
                );
            }

            $('#authForm').submit(function () {
                submitAuthenticateForm();
                return false;
            });
        });
    </script>
</head>
<body>
<div>
    <form id="authForm">
        <input id="username" name="username" type="text"/>
        <input id="secret" name="secret" type="password"/>
        <input id="oauth_consumer_key" name="oauth_consumer_key" type="hidden"/>
        <input id="grant_type" name="grant_type" type="hidden"/>
        <input type="submit" value="Submit"/>
    </form>
</div>
</body>
</html>
